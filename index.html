<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Verificador de QR Code</title>
<style>
    body {
        font-family: Arial, sans-serif;
        text-align: center;
        background-color: #f4f4f4;
        padding: 20px;
    }
    #reader {
        width: 300px;
        margin: auto;
    }
    .result {
        font-size: 2em;
        margin-top: 20px;
        font-weight: bold;
    }
    .ok {
        color: green;
    }
    .fail {
        color: red;
    }
    button {
        margin-top: 10px;
        padding: 10px 20px;
        font-size: 16px;
        border: none;
        background-color: #333;
        color: white;
        border-radius: 5px;
        cursor: pointer;
    }
    button:hover {
        background-color: #555;
    }
</style>
<script src="https://unpkg.com/html5-qrcode"></script>
</head>
<body>

<h1>Leitor de QR Code</h1>
<div id="reader"></div>
<button id="toggleCamera">Trocar câmera</button>
<div id="result" class="result"></div>

<script>
const LINK_CORRETO = "https://minianonimo.github.io/Paciente.github.io/";
let facingMode = "environment"; // Começa com câmera traseira
let html5QrCode;

// Sons
const beepSound = new Audio("https://pixabay.com/sound-effects/search/supermarket-scanners/");
const wohngSound = new Audio("https://mixkit.co/free-sound-effects/supermarket/");
beepSound.volume = 1; // Volume máximo
wohngSound.volume = 1;

// Função para tocar som sempre, reiniciando se necessário
function playSound(sound) {
    try {
        sound.pause();
        sound.currentTime = 0;
        sound.play().catch(err => console.log("Erro ao tocar som:", err));
    } catch (e) {
        console.log("Erro ao tocar som:", e);
    }
}

function startScanner() {
    if (html5QrCode) {
        html5QrCode.stop().then(() => initScanner())
        .catch(err => console.error("Erro ao parar scanner:", err));
    } else {
        initScanner();
    }
}

function initScanner() {
    html5QrCode = new Html5Qrcode("reader");
    html5QrCode.start(
        { facingMode: facingMode },
        { fps: 10, qrbox: 250 },
        decodedText => {
            const resultElement = document.getElementById("result");

            if (decodedText === LINK_CORRETO) {
                document.body.style.backgroundColor = "#c8f7c5";
                resultElement.innerHTML = "✔️ Autenticado";
                resultElement.className = "result ok";
                playSound(beepSound);
            } else {
                document.body.style.backgroundColor = "#f7c5c5";
                resultElement.innerHTML = "❌ Não autenticado";
                resultElement.className = "result fail";
                playSound(wohngSound);
            }
        },
        errorMessage => {
            // Ignora erros de leitura
        }
    ).catch(err => console.error("Erro ao iniciar câmera:", err));
}

// Alterna câmera
document.getElementById("toggleCamera").addEventListener("click", () => {
    facingMode = (facingMode === "environment") ? "user" : "environment";
    startScanner();
});

// Inicia scanner
startScanner();
</script>

</body>
</html>
